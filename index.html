<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TENG 圖片處理工具 v3.0 - 離線版</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet" />
  <script src="https://unpkg.com/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://unpkg.com/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css" rel="stylesheet" />
  <script src="heic-to.js"></script>
  <style>
    :root {
      --primary-color: #0033a0;
      --secondary-color: #005b99;
      --background-color: #e6f0fa;
      --light-background: #f5f8fa;
      --error-color: #ff3333;
      --success-color: #33cc33;
    }
    body {
      font-family: 'Roboto', sans-serif;
      background-color: var(--light-background);
      color: #333;
      margin: 0 auto;
      padding: 20px 15px;
      max-width: 900px;
      box-sizing: border-box;
    }
    .container {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    h1 {
      color: var(--primary-color);
      font-size: 28px;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .version {
      font-size: 15px;
      color: var(--secondary-color);
    }
    .section {
      background-color: var(--background-color);
      border: 1px solid var(--secondary-color);
      border-radius: 8px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    .file-button-container,
    .mode-buttons,
    .dimension-buttons,
    .size-buttons,
    .quality-buttons,
    .format-buttons,
    .ratio-buttons,
    .crop-size-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    .file-button,
    .clear-button,
    .process-button,
    .mode-button,
    .dimension-button,
    .size-button,
    .quality-button,
    .format-button,
    .ratio-button,
    .crop-size-button {
      font-size: 16px;
      padding: 10px 18px;
      border-radius: 6px;
      border: 1px solid var(--secondary-color);
      background-color: var(--background-color);
      color: var(--secondary-color);
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s;
      white-space: nowrap;
    }
    .file-button:hover,
    .clear-button:hover,
    .process-button:hover,
    .mode-button:hover,
    .dimension-button:hover,
    .size-button:hover,
    .quality-button:hover,
    .format-button:hover,
    .ratio-button:hover,
    .crop-size-button:hover {
      background-color: var(--secondary-color);
      color: #fff;
    }
    .mode-button.active,
    .dimension-button.active,
    .size-button.active,
    .quality-button.active,
    .format-button.active,
    .ratio-button.active,
    .crop-size-button.active {
      background-color: var(--primary-color);
      color: #fff;
      border-color: var(--primary-color);
    }
    .thumbnail-container {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      max-height: 320px;
      overflow-y: auto;
      padding: 10px 0;
    }
    .thumbnail {
      max-width: 70px;
      max-height: 70px;
      object-fit: contain;
      border: 1px solid var(--secondary-color);
      border-radius: 6px;
    }
    #fileList {
      max-height: 140px;
      overflow-y: auto;
      font-size: 14px;
      background-color: #fff;
      border-radius: 6px;
      padding: 12px;
    }
    .controls .control-row {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    label {
      font-size: 16px;
      color: var(--primary-color);
      font-weight: 600;
      min-width: 90px;
    }
    input[type="number"],
    textarea {
      flex-grow: 1;
      font-size: 14px;
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid var(--secondary-color);
      min-width: 80px;
    }
    @media (max-width: 600px) {
      body { padding: 15px 10px; }
      h1 { font-size: 24px; }
      .file-button-container,
      .mode-buttons,
      .dimension-buttons,
      .size-buttons,
      .quality-buttons,
      .format-buttons,
      .ratio-buttons,
      .crop-size-buttons {
        flex-direction: column;
        gap: 10px;
      }
      .controls .control-row {
        flex-direction: column;
        align-items: flex-start;
      }
      label { min-width: auto; font-size: 15px; }
      #fileList { max-height: 120px; font-size: 13px; }
      .thumbnail { max-width: 55px; max-height: 55px; }
      .process-button,
      .file-button,
      .clear-button {
        font-size: 16px;
        padding: 12px 0;
        width: 100%;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <h1>TENG 圖片處理工具 <span class="version">v3.0</span></h1>
  <div class="section">
    <label>處理模式</label>
    <div class="mode-buttons">
      <button class="mode-button active" data-mode="resize" onclick="switchMode('resize')">尺寸調整/格式轉換</button>
      <button class="mode-button" data-mode="crop" onclick="switchMode('crop')">圖片裁切</button>
      <button class="mode-button" data-mode="base64" onclick="switchMode('base64')">Base64互轉</button>
    </div>
  </div>
  <div class="section file-button-container">
    <div id="imageFileInputContainer">
      <label>圖片檔案</label>
      <button class="file-button" onclick="triggerFileInput('imageInput')">選擇圖片</button>
      <input type="file" id="imageInput" accept="image/*,.heic,.heif" multiple class="hidden" />
      <div class="help-text">支援 JPEG, PNG, HEIC, HEIF</div>
    </div>
    <div id="imageFolderInputContainer">
      <label>圖片資料夾</label>
      <button class="file-button" onclick="triggerFileInput('imageFolderInput')">選擇資料夾</button>
      <input type="file" id="imageFolderInput" webkitdirectory accept="image/*,.heic,.heif" class="hidden" />
      <div class="help-text">僅支援 Chrome, Edge, Safari</div>
    </div>
    <div id="base64FileInputContainer" class="mode-specific" data-mode="base64" style="display:none;">
      <label>Base64 檔案</label>
      <button class="file-button" onclick="triggerFileInput('base64FileInput')">選擇檔案</button>
      <input type="file" id="base64FileInput" accept=".txt" multiple class="hidden" />
      <div class="help-text">支援 .txt 檔案</div>
    </div>
    <div id="base64FolderInputContainer" class="mode-specific" data-mode="base64" style="display:none;">
      <label>Base64 資料夾</label>
      <button class="file-button" onclick="triggerFileInput('base64FolderInput')">選擇資料夾</button>
      <input type="file" id="base64FolderInput" webkitdirectory class="hidden" />
      <div class="help-text">僅支援 Chrome, Edge, Safari</div>
    </div>
    <div>
      <label>清空</label>
      <button class="clear-button" onclick="clearFiles()">清空檔案</button>
    </div>
  </div>
  <div class="section">
    <h3 style="margin: 0; font-size: 16px; color: #0033A0;">縮圖預覽</h3>
    <div id="previewContainer" class="thumbnail-container"></div>
  </div>
  <div class="section">
    <h3 id="fileListHeader" style="margin: 0; font-size: 16px; color: #0033A0;">
      <span class="status-indicator status-ready"></span>已選擇的檔案：
      <span id="fileCount">0</span> 張
    </h3>
    <div id="fileList"></div>
  </div>
  <div id="cropSection" class="section mode-specific" data-mode="crop" style="display:none;">
    <h3 style="margin: 0; font-size: 16px; color: #0033A0;">裁切圖片</h3>
    <div id="cropContainer" class="crop-container">
      <img id="cropImage" style="max-width: 100%;" class="hidden" />
    </div>
    <div class="file-button-container">
      <button class="process-button" id="applyCropBtn" onclick="applyCropping()" disabled>應用裁切</button>
      <button class="process-button" id="resetCropBtn" onclick="resetCropping()" disabled>重置裁切</button>
    </div>
    <div class="control-group">
      <div class="control-row">
        <label>裁切比例</label>
        <div class="ratio-buttons">
          <button class="ratio-button active" data-value="1/1" onclick="setRatio('1/1')">1:1 (正方形)</button>
          <button class="ratio-button" data-value="NaN" onclick="setRatio('NaN')">自訂比例</button>
          <button class="ratio-button" data-value="16/9" onclick="setRatio('16/9')">16:9 (橫幅)</button>
          <button class="ratio-button" data-value="9/16" onclick="setRatio('9/16')">9:16 (直幅)</button>
          <button class="ratio-button" data-value="4/3" onclick="setRatio('4/3')">4:3 (標準)</button>
          <button class="ratio-button" data-value="3/4" onclick="setRatio('3/4')">3:4 (肖像)</button>
        </div>
      </div>
      <div class="control-row">
        <label>輸出寬度 (px)</label>
        <div id="cropWidthButtons" class="crop-size-buttons" data-type="width">
          <button class="crop-size-button" data-value="1920" onclick="setCropDimension('width', 1920)">1920</button>
          <button class="crop-size-button" data-value="1280" onclick="setCropDimension('width', 1280)">1280</button>
          <button class="crop-size-button active" data-value="1024" onclick="setCropDimension('width', 1024)">1024</button>
          <button class="crop-size-button" data-value="720" onclick="setCropDimension('width', 720)">720</button>
          <button class="crop-size-button" data-value="512" onclick="setCropDimension('width', 512)">512</button>
          <button class="crop-size-button" data-value="256" onclick="setCropDimension('width', 256)">256</button>
          <button class="crop-size-button" data-value="custom" onclick="setCropDimension('width', 'custom')">自訂</button>
        </div>
        <input type="number" id="cropWidthInput" value="1024" min="1" class="hidden" />
      </div>
      <div class="control-row">
        <label>輸出高度 (px)</label>
        <div id="cropHeightButtons" class="crop-size-buttons" data-type="height">
          <button class="crop-size-button" data-value="1920" onclick="setCropDimension('height', 1920)">1920</button>
          <button class="crop-size-button" data-value="1280" onclick="setCropDimension('height', 1280)">1280</button>
          <button class="crop-size-button active" data-value="1024" onclick="setCropDimension('height', 1024)">1024</button>
          <button class="crop-size-button" data-value="720" onclick="setCropDimension('height', 720)">720</button>
          <button class="crop-size-button" data-value="512" onclick="setCropDimension('height', 512)">512</button>
          <button class="crop-size-button" data-value="256" onclick="setCropDimension('height', 256)">256</button>
          <button class="crop-size-button" data-value="custom" onclick="setCropDimension('height', 'custom')">自訂</button>
        </div>
        <input type="number" id="cropHeightInput" value="1024" min="1" class="hidden" />
      </div>
      <div class="control-row">
        <label>預計輸出尺寸</label>
        <span id="croppedDimensionsDisplay" style="font-weight: bold; color: var(--primary-color)">1024 x 1024 px</span>
      </div>
      <div class="control-row">
        <label>輸出格式</label>
        <div class="format-buttons">
          <button class="format-button active" data-value="image/jpeg" onclick="setCropFormat('image/jpeg')">JPEG</button>
          <button class="format-button" data-value="image/png" onclick="setCropFormat('image/png')">PNG</button>
          <button class="format-button" data-value="image/webp" onclick="setCropFormat('image/webp')">WebP</button>
        </div>
      </div>
      <div class="control-row">
        <label>輸出品質</label>
        <div class="quality-buttons">
          <button class="quality-button active" data-value="1.0" onclick="setCropQuality('1.0')">100%</button>
          <button class="quality-button" data-value="0.95" onclick="setCropQuality('0.95')">95%</button>
          <button class="quality-button" data-value="0.9" onclick="setCropQuality('0.9')">90%</button>
          <button class="quality-button" data-value="0.85" onclick="setCropQuality('0.85')">85%</button>
          <button class="quality-button" data-value="0.8" onclick="setCropQuality('0.8')">80%</button>
          <button class="quality-button" data-value="0.7" onclick="setCropQuality('0.7')">70%</button>
        </div>
      </div>
    </div>
    <img id="resultPreview" src="" alt="裁切結果" class="hidden" />
  </div>

<script>
// JavaScript 程式內容請完整貼入這裡，包含您先前的全部功能函式與事件監聽

// 範例開始
let originalImages = [];
let processedBlobs = [];
let base64Data = [];
let downloadBlob = null;
let downloadFileName = '';
let currentDimensionMode = 'width';
let currentWidthValue = '1024';
let currentHeightValue = '1024';
let currentQualityValue = '0.9';
let currentFormatValue = 'image/jpeg';
let isProcessing = false;
let startTime = null;
let processedCount = 0;
let totalToProcess = 0;
let selectedFileType = null;
let cropper = null;
let currentCroppingFile = null;
let currentCropRatio = 1 / 1;

function checkDirectorySupport() {
  const input = document.createElement('input');
  input.setAttribute('webkitdirectory', '');
  return 'webkitdirectory' in input;
}

// 其餘全部函式 及 事件監聽全部貼入此處...

window.onload = function () {
  switchMode('resize');
  updateProcessButtons();
  if (!checkDirectorySupport()) {
    showError('警告：此瀏覽器不支援資料夾選擇，請使用 Chrome、Edge 或 Safari！');
  }
};

// =============================================
// 請確保貼入完整JS內容，此處為示意
// =============================================
</script>
</body>
</html>
